!function o(s,a,n){function r(t,e){if(!a[t]){if(!s[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(i=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",i}i=a[t]={exports:{}},s[t][0].call(i.exports,function(e){return r(s[t][1][e]||e)},i,i.exports,o,s,a,n)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<n.length;e++)r(n[e]);return r}({1:[function(e,t,i){const c=e("./simpleSelectMenu"),o=e("./simpleConfirmDialog");function s(){this.filters={},this.previousSelectedADT=null,this.selectedADT=null,this.testTwinsInfo=null,this.storedOutboundRelationships={},this.storedTwins={},this.DOM||(this.DOM=$('<div class="w3-modal" style="display:block;z-index:101"></div>'),this.DOM.css("overflow","hidden"),$("body").append(this.DOM))}s.prototype.preparationFunc=async function(){return new Promise((i,t)=>{try{$.get("twinsFilter/readStartFilters",(e,t)=>{null!=e&&""!=e&&(this.filters=e),i()})}catch(e){t(e)}})},s.prototype.popup=function(){$.get("queryADT/listADTInstance",(e,t)=>{var i,o,s,a,n,r,l,d=e=""==e?[]:e;0!=d.length&&(this.DOM.show(),this.DOM.empty(),this.contentDOM=$('<div class="w3-modal-content" style="width:650px"></div>'),this.DOM.append(this.contentDOM),this.contentDOM.append($('<div style="height:40px" class="w3-bar w3-red"><div class="w3-bar-item" style="font-size:1.5em">Choose1 Data Set</div></div>')),o=$('<button class="w3-bar-item w3-button w3-right" style="font-size:2em;padding-top:4px">×</button>'),this.contentDOM.children(":first").append(o),this.buttonHolder=$("<div style='height:100%'></div>"),this.contentDOM.children(":first").append(this.buttonHolder),o.on("click",()=>{this.closeDialog()}),a=$('<div class="w3-bar" style="padding:2px"></div>'),this.contentDOM.append(a),s=$('<div class="w3-bar-item w3-opacity" style="padding-right:5px;font-size:1.2em;">Azure Digital Twin ID </div>'),a.append(s),i=new c(" ",{withBorder:1,fontSize:"1.2em",colorClass:"w3-light-gray",buttonCSS:{padding:"5px 10px"}}),a.append(i.DOM),d.forEach(e=>{var t=e.split(".")[0].replace("https://","");i.addOption(t,e),null==this.filters[e]&&(this.filters[e]={})}),i.callBack_clickOption=(e,t)=>{i.changeName(e),this.setADTInstance(t)},l=$('<div class="w3-cell-row"></div>'),this.contentDOM.append(l),(r=$('<div class="w3-cell" style="width:240px;padding-right:5px"></div>')).append($('<div style="height:30px" class="w3-bar w3-red"><div class="w3-bar-item" style="">Filters</div></div>')),(n=$('<ul class="w3-ul w3-hoverable">')).css({"overflow-x":"hidden","overflow-y":"auto",height:"340px",border:"solid 1px lightgray"}),r.append(n),this.filterList=n,l.append(r),e=$('<div class="w3-container w3-cell"></div>'),l.append(e),o=$('<div class="w3-card-2 w3-white" style="padding:10px"></div>'),e.append(o),s=$("<span/>"),o.append(s),a=$('<input type="text" style="outline:none"  placeholder="Choose a filter or fill in new filter name..."/>').addClass("w3-input w3-border"),this.queryNameInput=a,d=$('<div class="w3-bar w3-red" style="padding-left:5px;margin-top:2px;width:50%">Query Sentence</div>'),n=$('<textarea style="resize:none;height:80px;outline:none;margin-bottom:2px"  placeholder="Sample: SELECT * FROM digitaltwins where IS_OF_MODEL(\'modelID\')"/>').addClass("w3-input w3-border"),this.queryInput=n,r=$('<button class="w3-button w3-hover-light-green w3-border-right">Save Filter</button>'),l=$('<button class="w3-button w3-hover-amber w3-border-right">Test Query</button>'),e=$('<button class="w3-button w3-hover-pink w3-border-right">Delete Filter</button>'),l.on("click",()=>{this.testQuery()}),r.on("click",()=>{this.saveQuery()}),e.on("click",()=>{this.delQuery()}),s.append(a,d,n,r,l,e),l=$("<div class='w3-border'></div>"),e=$("<table></table>"),this.testResultTable=e,l.css({"margin-top":"2px",overflow:"auto",height:"175px",width:"400px"}),e.css({"border-collapse":"collapse"}),o.append(l),l.append(e),this.bottomBar=$('<div class="w3-bar"></div>'),this.contentDOM.append(this.bottomBar),null!=this.previousSelectedADT?i.triggerOptionValue(this.previousSelectedADT):i.triggerOptionIndex(0))})},s.prototype.setADTInstance=function(e){var t,i;this.bottomBar.empty(),this.buttonHolder.empty(),null==this.previousSelectedADT||this.previousSelectedADT==e?(i=$('<button class="w3-button w3-card w3-deep-orange w3-hover-green" style="height:100%; margin-right:8px">Replace All Data</button>'),t=$('<button class="w3-button w3-card w3-deep-orange w3-hover-green" style="height:100%">Append Data</button>'),i.on("click",()=>{this.useFilterToReplace()}),t.on("click",()=>{this.useFilterToAppend()}),this.buttonHolder.append(i,t)):((i=$('<button class="w3-button w3-green w3-border-right" style="height:100%">Replace All Data</button>')).on("click",()=>{this.useFilterToReplace()}),this.buttonHolder.append(i)),this.selectedADT=e,this.listFilters(e),this.chooseOneFilter("",""),$.ajaxSetup({headers:{adtInstance:this.selectedADT}})},s.prototype.delQuery=function(){var e,t=this.queryNameInput.val();"ALL"!=t&&""!=t&&(e=new o).show({width:"250px"},{title:"Confirm",content:'Please confirm deleting filter "'+t+'"?',buttons:[{colorClass:"w3-red w3-hover-pink",text:"Confirm",clickFunc:()=>{this.queryNameInput.val(""),this.queryInput.val(""),this.testResultTable.empty(),delete this.filters[this.selectedADT][t],this.listFilters(this.selectedADT),this.chooseOneFilter("",""),$.post("twinsFilter/saveStartFilters",{filters:this.filters}),e.close()}},{colorClass:"w3-gray",text:"Cancel",clickFunc:()=>{e.close()}}]})},s.prototype.saveQuery=function(){var i=this.queryNameInput.val(),e=this.queryInput.val();""!=i?(this.filters[this.selectedADT][i]=e,this.listFilters(this.selectedADT),this.filterList.children().each((e,t)=>{$(t).data("filterName")==i&&$(t).trigger("click")}),$.post("twinsFilter/saveStartFilters",{filters:this.filters})):alert("Please fill in query name")},s.prototype.testQuery=function(){this.testResultTable.empty();var e=this.queryInput.val();""!=e&&$.post("queryADT/allTwinsInfo",{query:e},e=>{var t;""==e&&(e=[]),Array.isArray(e)?0==(this.testTwinsInfo=e).length?(t=$('<tr><td style="color:gray">zero record</td><td style="border-bottom:solid 1px lightgrey"></td></tr>'),this.testResultTable.append(t)):(t=$('<tr><td style="border-right:solid 1px lightgrey;border-bottom:solid 1px lightgrey;font-weight:bold">ID</td><td style="border-bottom:solid 1px lightgrey;font-weight:bold">MODEL</td></tr>'),this.testResultTable.append(t),e.forEach(e=>{this.storedTwins[e.$dtId]=e;e=$('<tr><td style="border-right:solid 1px lightgrey;border-bottom:solid 1px lightgrey">'+e.$dtId+'</td><td style="border-bottom:solid 1px lightgrey">'+e.$metadata.$model+"</td></tr>");this.testResultTable.append(e)})):alert("Query is not correct!")})},s.prototype.listFilters=function(e){var t=this.filters[e];t.ALL="SELECT * FROM digitaltwins";var i,o=this.filterList;for(i in o.empty(),t){var s=$('<li style="font-size:1em">'+i+"</li>");s.css("cursor","default"),s.data("filterName",i),s.data("filterQuery",t[i]),"ALL"==i?o.prepend(s):o.append(s),this.assignEventToOneFilter(s),s.on("dblclick",e=>{this.previousSelectedADT==this.selectedADT?this.useFilterToAppend():this.useFilterToReplace()})}},s.prototype.assignEventToOneFilter=function(o){o.on("click",e=>{this.filterList.children().each((e,t)=>{$(t).removeClass("w3-amber")}),o.addClass("w3-amber");var t=o.data("filterName"),i=o.data("filterQuery");this.chooseOneFilter(t,i)})},s.prototype.useFilterToAppend=function(){""!=this.queryInput.val()?(null==this.previousSelectedADT?this.broadcastMessage({message:"ADTDatasourceChange_replace",query:this.queryInput.val(),twins:this.testTwinsInfo}):(this.previousSelectedADT=this.selectedADT,this.broadcastMessage({message:"ADTDatasourceChange_append",query:this.queryInput.val(),twins:this.testTwinsInfo})),this.closeDialog()):alert("Please fill in query to fetch data from digital twin service..")},s.prototype.closeDialog=function(){this.DOM.hide(),this.broadcastMessage({message:"ADTDatasourceDialog_closed"})},s.prototype.storeTwinRelationships_remove=function(e){e.forEach(e=>{var t=e.srcID;if(this.storedOutboundRelationships[t])for(var i=this.storedOutboundRelationships[t],o=0;o<i.length;o++)if(i[o].$relationshipId==e.relID){i.splice(o,1);break}})},s.prototype.storeTwinRelationships_append=function(e){e.forEach(e=>{this.storedOutboundRelationships[e.$sourceId]||(this.storedOutboundRelationships[e.$sourceId]=[]),this.storedOutboundRelationships[e.$sourceId].push(e)})},s.prototype.storeTwinRelationships=function(e){e.forEach(e=>{e=e.$sourceId;this.storedOutboundRelationships[e]=[]}),e.forEach(e=>{this.storedOutboundRelationships[e.$sourceId].push(e)})},s.prototype.useFilterToReplace=function(){if(""!=this.queryInput.val()){var e=!0;if(this.previousSelectedADT!=this.selectedADT){for(var t in this.storedOutboundRelationships)delete this.storedOutboundRelationships[t];for(var t in this.storedTwins)delete this.storedTwins[t];e=!1}this.previousSelectedADT=this.selectedADT,this.broadcastMessage({message:"ADTDatasourceChange_replace",query:this.queryInput.val(),twins:this.testTwinsInfo,ADTInstanceDoesNotChange:e}),this.closeDialog()}else alert("Please fill in query to fetch data from digital twin service..")},s.prototype.chooseOneFilter=function(e,t){this.queryNameInput.val(e),this.queryInput.val(t),this.testResultTable.empty(),this.testTwinsInfo=null},t.exports=new s},{"./simpleConfirmDialog":9,"./simpleSelectMenu":10}],2:[function(e,t,i){const o=e("./adtInstanceSelectionDialog"),s=e("./simpleSelectMenu"),a=e("./simpleConfirmDialog");function n(){this.DOM||(this.DOM=$('<div style="position:absolute;top:50%;background-color:white;left:50%;transform: translateX(-50%) translateY(-50%);z-index:101" class="w3-card-2"></div>'),$("body").append(this.DOM),this.DOM.hide()),this.layoutJSON={},this.currentLayoutName=null}n.prototype.getCurADTName=function(){return o.selectedADT.replace("https://","")},n.prototype.rxMessage=function(e){if("ADTDatasourceChange_replace"==e.message)try{$.post("layout/readLayouts",{adtName:this.getCurADTName()},(e,t)=>{this.layoutJSON=""!=e&&"object"==typeof e?e:{},this.broadcastMessage({message:"layoutsUpdated"})})}catch(e){console.log(e)}},n.prototype.refillOptions=function(){for(var e in this.switchLayoutSelector.clearOptions(),this.layoutJSON)this.switchLayoutSelector.addOption(e)},n.prototype.popup=function(){this.DOM.show(),this.DOM.empty(),this.DOM.css({width:"320px","padding-bottom":"3px"}),this.DOM.append($('<div style="height:40px;margin-bottom:2px" class="w3-bar w3-red"><div class="w3-bar-item" style="font-size:1.2em">Layout</div></div>'));var e=$('<button class="w3-bar-item w3-button w3-right" style="font-size:2em;padding-top:4px">×</button>');this.DOM.children(":first").append(e),e.on("click",()=>{this.DOM.hide()});var t=$('<input type="text" style="outline:none; width:180px; display:inline;margin-left:2px;margin-right:2px"  placeholder="Fill in a new layout name..."/>').addClass("w3-input w3-border");this.DOM.append(t);var i,o=$('<button class="w3-button w3-green w3-hover-light-green">Save As New</button>');this.DOM.append(o),o.on("click",()=>{this.saveIntoLayout(t.val())}),jQuery.isEmptyObject(this.layoutJSON)||(e=$('<div class="w3-bar w3-padding-16" style="text-align:center;">- OR -</div>'),this.DOM.append(e),i=new s("",{fontSize:"1em",colorClass:"w3-light-gray",width:"120px"}),this.switchLayoutSelector=i,this.refillOptions(),this.switchLayoutSelector.callBack_clickOption=(e,t)=>{null==e?this.switchLayoutSelector.changeName(" "):this.switchLayoutSelector.changeName(e)},o=$('<button class="w3-button w3-green w3-hover-light-green" style="margin-left:2px;margin-right:5px">Save As</button>'),e=$('<button class="w3-button w3-red w3-hover-pink" style="margin-left:5px">Delete Layout</button>'),this.DOM.append(o,i.DOM,e),o.on("click",()=>{this.saveIntoLayout(i.curSelectVal)}),e.on("click",()=>{this.deleteLayout(i.curSelectVal)}),null!=this.currentLayoutName?i.triggerOptionValue(this.currentLayoutName):i.triggerOptionIndex(0))},n.prototype.saveIntoLayout=function(e){""!=e&&null!=e?(this.broadcastMessage({message:"saveLayout",layoutName:e,adtName:this.getCurADTName()}),this.DOM.hide()):alert("Please choose target layout Name")},n.prototype.deleteLayout=function(e){var t;""!=e&&null!=e?(t=new a).show({width:"250px"},{title:"Confirm",content:'Please confirm deleting layout "'+e+'"?',buttons:[{colorClass:"w3-red w3-hover-pink",text:"Confirm",clickFunc:()=>{delete this.layoutJSON[e],e==this.currentLayoutName&&(this.currentLayoutName=null),this.broadcastMessage({message:"layoutsUpdated"}),$.post("layout/saveLayouts",{adtName:this.getCurADTName(),layouts:JSON.stringify(this.layoutJSON)}),t.close(),this.refillOptions(),this.switchLayoutSelector.triggerOptionIndex(0)}},{colorClass:"w3-gray",text:"Cancel",clickFunc:()=>{t.close()}}]}):alert("Please choose target layout Name")},t.exports=new n},{"./adtInstanceSelectionDialog":1,"./simpleConfirmDialog":9,"./simpleSelectMenu":10}],3:[function(e,t,i){const r=e("./adtInstanceSelectionDialog"),l=e("./modelAnalyzer"),n=e("./simpleSelectMenu");function o(){this.continerDOM=$('<div class="w3-card" style="position:absolute;z-index:90;right:0px;top:50%;height:70%;width:300px;transform: translateY(-50%);"></div>'),this.continerDOM.hide(),this.continerDOM.append($('<div style="height:50px" class="w3-bar w3-red"></div>')),this.closeButton1=$('<button style="height:100%" class="w3-bar-item w3-button"><i class="fa fa-info-circle fa-2x" style="padding:2px"></i></button>'),this.closeButton2=$('<button class="w3-bar-item w3-button w3-right" style="font-size:2em">×</button>'),this.continerDOM.children(":first").append(this.closeButton1,this.closeButton2),this.isMinimized=!1;var e=()=>{this.isMinimized?(this.continerDOM.animate({right:"0px",height:"70%"}),this.isMinimized=!1):(this.continerDOM.animate({right:"-250px",height:"50px"}),this.isMinimized=!0)};this.closeButton1.on("click",e),this.closeButton2.on("click",e),this.DOM=$('<div class="w3-container" style="postion:absolute;top:50px;height:calc(100% - 50px);overflow:auto"></div>'),this.continerDOM.css("background-color","rgba(255, 255, 255, 0.8)"),this.continerDOM.append(this.DOM),$("body").append(this.continerDOM),this.DOM.html("<a style='display:block;font-style:italic;color:gray'>Choose twins or relationships to view infomration</a><a style='display:block;font-style:italic;color:gray;padding-top:20px'>Press shift key to select multiple in topology view</a><a style='display:block;font-style:italic;color:gray;padding-top:20px'>Press ctrl key to select multiple in tree view</a>"),this.selectedObjects=null}o.prototype.rxMessage=function(e){var t,i,o,s,a,n;"ADTDatasourceDialog_closed"==e.message?this.continerDOM.is(":visible")||(this.continerDOM.show(),this.continerDOM.addClass("w3-animate-right")):"selectNodes"==e.message?(this.DOM.empty(),t=e.info,1==(this.selectedObjects=t).length?(i=t[0]).$dtId?(this.drawButtons("singleNode"),this.drawStaticInfo(this.DOM,{$dtId:i.$dtId},"1em","13px"),s=i.$metadata.$model,l.DTDLModels[s]&&this.drawEditable(this.DOM,l.DTDLModels[s].editableProperties,i,[]),this.drawStaticInfo(this.DOM,{$etag:i.$etag,$metadata:i.$metadata},"1em","10px")):i.$sourceId&&(this.drawButtons("singleRelationship"),this.drawStaticInfo(this.DOM,{$sourceId:i.$sourceId,$targetId:i.$targetId,$relationshipName:i.$relationshipName,$relationshipId:i.$relationshipId},"1em","13px"),o=i.$relationshipName,s=i.sourceModel,this.drawEditable(this.DOM,this.getRelationShipEditableProperties(o,s),i,[]),this.drawStaticInfo(this.DOM,{$etag:i.$etag},"1em","10px","DarkGray")):1<t.length&&(this.drawButtons("multiple"),this.drawMultipleObj())):"selectGroupNode"==e.message&&(this.DOM.empty(),a=e.info["@id"],l.DTDLModels[a]&&(n={$metadata:{$model:a}},e=$('<button class="w3-button w3-green w3-hover-light-green w3-margin">Add Twin</button>'),this.DOM.append(e),e.on("click",e=>{n.$dtId&&""!=n.$dtId?(l.DTDLModels[a].includedComponents.forEach(e=>{null==n[e]&&(n[e]={}),n[e].$metadata={}}),$.post("editADT/upsertDigitalTwin",{newTwinJson:JSON.stringify(n)},e=>{""!=e?alert(e):((e=this.DOM.find("#NEWTWIN_IDLabel").find("input"))&&e.val(""),$.post("queryADT/oneTwinInfo",{twinID:n.$dtId},e=>{""!=e&&(r.storedTwins[e.$dtId]=e,this.broadcastMessage({message:"addNewTwin",twinInfo:e}))}))})):alert("Please fill in name for the new digital twin")}),this.drawStaticInfo(this.DOM,{Model:a}),e.data("twinJson",n),(e=JSON.parse(JSON.stringify(l.DTDLModels[a].editableProperties))).$dtId="string",this.drawEditable(this.DOM,e,n,[],"newTwin")))},o.prototype.getRelationShipEditableProperties=function(e,t){if(l.DTDLModels[t]&&l.DTDLModels[t].validRelationships[e])return l.DTDLModels[t].validRelationships[e].editableRelationshipProperties},o.prototype.drawButtons=function(e){var t=$('<button class="w3-bar-item w3-button w3-black"><i class="fa fa-refresh"></i></button>');t.on("click",()=>{this.refreshInfomation()}),this.DOM.append(t),"singleRelationship"==e?(a=$('<button style="width:80%" class="w3-button w3-red w3-hover-pink w3-border">Delete All</button>'),this.DOM.append(a),a.on("click",()=>{this.deleteSelected()})):"singleNode"!=e&&"multiple"!=e||(a=$('<button style="width:80%" class="w3-button w3-red w3-hover-pink w3-border">Delete All</button>'),o=$('<button style="width:45%"  class="w3-button w3-border">Connect to</button>'),s=$('<button style="width:45%" class="w3-button w3-border">Connect from</button>'),i=$('<button  style="width:45%" class="w3-button w3-border">Query Inbound</button>'),e=$('<button style="width:45%" class="w3-button w3-border">Query Outbound</button>'),this.DOM.append(a,o,s,i,e),e.on("click",()=>{this.showOutBound()}),i.on("click",()=>{this.showInBound()}),o.on("click",()=>{this.broadcastMessage({message:"connectTo"})}),s.on("click",()=>{this.broadcastMessage({message:"connectFrom"})}),a.on("click",()=>{this.deleteSelected()}));var i,o,s,a,n=0;this.selectedObjects.forEach(e=>{e.$dtId&&n++}),0<n&&(i=$('<button class="w3-button w3-border">+Select Inbound</button>'),o=$('<button class="w3-button w3-border">+Select Outbound</button>'),s=$('<button class="w3-button w3-border">COSE View</button>'),a=$('<button class="w3-button w3-border">Hide</button>'),this.DOM.append(i,o,s,a),i.on("click",()=>{this.broadcastMessage({message:"addSelectInbound"})}),o.on("click",()=>{this.broadcastMessage({message:"addSelectOutbound"})}),s.on("click",()=>{this.broadcastMessage({message:"COSESelectedNodes"})}),a.on("click",()=>{this.broadcastMessage({message:"hideSelectedNodes"})}))},o.prototype.refreshInfomation=async function(){var e=this.selectedObjects,t=[];e.forEach(e=>{e.$relationshipId?t.push({$sourceId:e.$sourceId,$relationshipId:e.$relationshipId}):t.push({$dtId:e.$dtId})}),$.post("queryADT/fetchInfomation",{elements:t},e=>{""!=e&&(e.forEach(i=>{if(i.$relationshipId){var e=i.$sourceId,o=i.$relationshipId;null!=r.storedOutboundRelationships[e]&&r.storedOutboundRelationships[e].forEach(e=>{if(e.$relationshipId==o)for(var t in i)e[t]=i[t]})}else{var t=i.$dtId;if(null!=r.storedTwins[t])for(var s in i)r.storedTwins[t][s]=i[s]}}),1==this.selectedObjects.length&&this.rxMessage({message:"selectNodes",info:this.selectedObjects}))})},o.prototype.deleteSelected=async function(){var e=this.selectedObjects;if(0!=e.length){var t=[],i=[],o={};e.forEach(e=>{e.$sourceId?t.push(e):(i.push(e.$dtId),o[e.$dtId]=1)});for(var s=t.length-1;0<=s;s--){var a=t[s].$sourceId,n=t[s].$targetId;null==o[a]&&null==o[n]||t.splice(s,1)}var r=$("<div/>"),l="",d=i.length,e=t.length;0<d&&(l=d+" twin"+(1<d?"s":"")+" (with connected relations)"),0<d&&0<e&&(l+=" and additional "),0<e&&(l+=e+" relation"+(1<e?"s":"")),r.text(l+=" will be deleted. Please confirm"),$("body").append(r),r.dialog({buttons:[{text:"Confirm",click:()=>{0<i.length&&this.deleteTwins(i),0<t.length&&this.deleteRelations(t),r.dialog("destroy"),this.DOM.empty()}},{text:"Cancel",click:()=>{r.dialog("destroy")}}]})}},o.prototype.deleteTwins=async function(e){for(;0<e.length;){var t=e.splice(0,100),t=await this.deletePartialTwins(t);t.forEach(e=>{delete r.storedTwins[e],delete r.storedOutboundRelationships[e]}),this.broadcastMessage({message:"twinsDeleted",twinIDArr:t})}},o.prototype.deletePartialTwins=async function(e){return new Promise((t,i)=>{try{$.post("editADT/deleteTwins",{arr:e},function(e){t(e=""==e?[]:e)})}catch(e){i(e)}})},o.prototype.deleteRelations=async function(e){var t=[];e.forEach(e=>{t.push({srcID:e.$sourceId,relID:e.$relationshipId})}),$.post("editADT/deleteRelations",{relations:t},e=>{""==e&&(e=[]),r.storeTwinRelationships_remove(e),this.broadcastMessage({message:"relationsDeleted",relations:e})})},o.prototype.showOutBound=async function(){var e=this.selectedObjects,t=[];for(e.forEach(e=>{e.$sourceId||t.push(e.$dtId)});0<t.length;){var i=t.splice(0,100),i=await this.fetchPartialOutbounds(i);""!=i&&(r.storeTwinRelationships(i.newTwinRelations),i.childTwinsAndRelations.forEach(e=>{for(var t in e.childTwins){var i=e.childTwins[t];r.storedTwins[t]=i}}),this.broadcastMessage({message:"drawTwinsAndRelations",info:i}))}},o.prototype.showInBound=async function(){var e=this.selectedObjects,t=[];for(e.forEach(e=>{e.$sourceId||t.push(e.$dtId)});0<t.length;){var i=t.splice(0,100),i=await this.fetchPartialInbounds(i);""!=i&&(r.storeTwinRelationships(i.newTwinRelations),i.childTwinsAndRelations.forEach(e=>{for(var t in e.childTwins){var i=e.childTwins[t];r.storedTwins[t]=i}}),this.broadcastMessage({message:"drawTwinsAndRelations",info:i}))}},o.prototype.fetchPartialOutbounds=async function(e){return new Promise((t,i)=>{try{var o={};e.forEach(e=>{o[e]=1;e=r.storedOutboundRelationships[e];e&&e.forEach(e=>{e=e.$targetId;null!=r.storedTwins[e]&&(o[e]=1)})}),$.post("queryADT/showOutBound",{arr:e,knownTargets:o},function(e){t(e)})}catch(e){i(e)}})},o.prototype.fetchPartialInbounds=async function(a){return new Promise((t,i)=>{try{var e,o={},s={};for(e in a.forEach(e=>{s[e]=1,o[e]=1}),r.storedOutboundRelationships)r.storedOutboundRelationships[e].forEach(e=>{var t=e.$targetId,e=e.$sourceId;null!=s[t]&&null!=r.storedTwins[e]&&(o[e]=1)});$.post("queryADT/showInBound",{arr:a,knownSources:o},function(e){t(e)})}catch(e){i(e)}})},o.prototype.drawMultipleObj=function(){var t=0,i=0,e=this.selectedObjects;null!=e&&(e.forEach(e=>{e.$sourceId?t++:i++}),(e=$("<label style='display:block;margin-top:10px'></label>")).text(i+" node"+(i<=1?"":"s")+", "+t+" relationship"+(t<=1?"":"s")),this.DOM.append(e))},o.prototype.drawStaticInfo=function(e,t,i,o){for(var s in t){var a=$("<label style='display:block'><div class='w3-border' style='background-color:#f6f6f6;display:inline;padding:.1em .3em .1em .3em;margin-right:.3em'>"+s+"</div></label>");a.css({fontSize:o,color:"darkGray"}),e.append(a),a.css("padding-top",i);var n=$("<label></label>");"object"==typeof t[s]?(n.css("display","block"),n.css("padding-left","1em"),this.drawStaticInfo(n,t[s],".5em",o)):(n.css("padding-top",".2em"),n.text(t[s])),n.css({fontSize:o,color:"black"}),a.append(n)}},o.prototype.drawEditable=function(e,t,i,o,s){if(null!=t)for(var a in t){var n=$("<label style='display:block'><div style='display:inline;padding:.1em .3em .1em .3em; font-weight:bold;color:black'>"+a+"</div></label>");s&&"$dtId"==a?(e.prepend(n),n.attr("id","NEWTWIN_IDLabel")):e.append(n),n.css("padding-top",".3em");var r,l,d=$("<label style='padding-top:.2em'></label>"),c=o.concat([a]);Array.isArray(t[a])?this.drawDropdownOption(d,c,t[a],s,i):"object"==typeof t[a]?(d.css("display","block"),d.css("padding-left","1em"),this.drawEditable(d,t[a],i,c,s)):(r=$('<input type="text" style="padding:2px;width:50%;outline:none;display:inline" placeholder="type: '+t[a]+'"/>').addClass("w3-input w3-border"),d.append(r),null!=(l=this.searchValue(i,c))&&r.val(l),r.data("path",c),r.data("dataType",t[a]),r.change(e=>{this.editDTProperty(i,$(e.target).data("path"),$(e.target).val(),$(e.target).data("dataType"),s)})),n.append(d)}},o.prototype.drawDropdownOption=function(e,t,i,o,s){var a=new n("",{buttonCSS:{padding:"4px 16px"}});e.append(a.DOM),a.DOM.data("path",t),i.forEach(e=>{e=e.displayName||e.enumValue;a.addOption(e)}),a.callBack_clickOption=(e,t)=>{a.changeName(e),this.editDTProperty(s,a.DOM.data("path"),t,"string",o)};t=this.searchValue(s,t);null!=t&&a.triggerOptionValue(t)},o.prototype.editDTProperty=function(t,i,o,e,s){var a,n,r,l,d;["double","boolean","float","integer","long"].includes(e)&&(o=Number(o)),s?this.updateOriginObjectValue(t,i,o):(n=1==i.length?(a="",i.forEach(e=>{a+="/"+e}),[{op:"add",path:a,value:o}]):(n=i[0],l=null==(l=t[n])?{}:JSON.parse(JSON.stringify(l)),this.updateOriginObjectValue(l,i.slice(1),o),[{op:"add",path:"/"+n,value:l}]),t.$dtId?(r=t.$dtId,d={jsonPatch:JSON.stringify(n),twinID:r}):t.$relationshipId&&(r=t.$sourceId,l=t.$relationshipId,d={jsonPatch:JSON.stringify(n),twinID:r,relationshipID:l}),$.post("editADT/changeAttribute",d,e=>{""!=e?alert(e):this.updateOriginObjectValue(t,i,o)}))},o.prototype.updateOriginObjectValue=function(e,t,i){if(0!=t.length)for(var o=e,s=0;s<t.length;s++){var a=t[s];if(s==t.length-1){o[a]=i;break}null==o[a]&&(o[a]={}),o=o[a]}},o.prototype.searchValue=function(e,t){if(0==t.length)return null;for(var i=e,o=0;o<t.length;o++)if(null==(i=i[t[o]]))return null;return i},t.exports=new o},{"./adtInstanceSelectionDialog":1,"./modelAnalyzer":7,"./simpleSelectMenu":10}],4:[function(e,t,i){$("document").ready(function(){e("./mainUI.js")})},{"./mainUI.js":6}],5:[function(e,t,i){const o=e("./adtInstanceSelectionDialog"),s=e("./modelManagerDialog"),a=e("./editLayoutDialog"),n=e("./simpleSelectMenu");function r(){}r.prototype.render=function(){$("#mainToolBar").addClass("w3-bar w3-red"),$("#mainToolBar").css({"z-index":100,overflow:"visible"}),this.switchADTInstanceBtn=$('<a class="w3-bar-item w3-button" href="#">Source</a>'),this.modelIOBtn=$('<a class="w3-bar-item w3-button" href="#">Models</a>'),this.showForgeViewBtn=$('<a class="w3-bar-item w3-button w3-hover-none w3-text-light-grey w3-hover-text-light-grey" style="opacity:.35" href="#">ForgeView</a>'),this.showGISViewBtn=$('<a class="w3-bar-item w3-button w3-hover-none w3-text-light-grey w3-hover-text-light-grey" style="opacity:.35" href="#">GISView</a>'),this.editLayoutBtn=$('<a class="w3-bar-item w3-button" href="#"><i class="fa fa-edit"></i></a>'),this.switchLayoutSelector=new n("Layout"),$("#mainToolBar").empty(),$("#mainToolBar").append(this.switchADTInstanceBtn,this.modelIOBtn,this.showForgeViewBtn,this.showGISViewBtn,this.switchLayoutSelector.DOM,this.editLayoutBtn),this.switchADTInstanceBtn.on("click",()=>{o.popup()}),this.modelIOBtn.on("click",()=>{s.popup()}),this.editLayoutBtn.on("click",()=>{a.popup()}),this.switchLayoutSelector.callBack_clickOption=(e,t)=>{a.currentLayoutName=t,this.broadcastMessage({message:"layoutChange"}),"[NA]"==t?this.switchLayoutSelector.changeName("Layout",""):this.switchLayoutSelector.changeName("Layout:",e)}},r.prototype.updateLayoutSelector=function(){var e,t=this.switchLayoutSelector.curSelectVal;for(e in this.switchLayoutSelector.clearOptions(),this.switchLayoutSelector.addOption("[No Layout Specified]","[NA]"),a.layoutJSON)this.switchLayoutSelector.addOption(e);null!=t&&null==this.switchLayoutSelector.findOption(t)&&this.switchLayoutSelector.changeName("Layout","")},r.prototype.rxMessage=function(e){"layoutsUpdated"==e.message&&this.updateLayoutSelector()},t.exports=new r},{"./adtInstanceSelectionDialog":1,"./editLayoutDialog":2,"./modelManagerDialog":8,"./simpleSelectMenu":10}],6:[function(e,t,i){"use strict";const o=e("./topologyDOM.js"),s=e("./twinsTree"),a=e("./adtInstanceSelectionDialog"),n=e("./modelManagerDialog"),r=e("./editLayoutDialog"),l=e("./mainToolbar"),d=e("./infoPanel");function c(){this.initUILayout(),this.twinsTree=new s($("#treeHolder"),$("#treeSearch")),this.mainToolbar=l,l.render(),this.topologyInstance=new o($("#canvas")),this.topologyInstance.init(),this.infoPanel=d,this.broadcastMessage(),this.prepareData()}c.prototype.prepareData=async function(){var e=[n.preparationFunc(),a.preparationFunc()];await Promise.allSettled(e),a.popup()},c.prototype.assignBroadcastMessage=function(t){t.broadcastMessage=e=>{this.broadcastMessage(t,e)}},c.prototype.broadcastMessage=function(e,t){var i=[this.twinsTree,a,n,r,this.mainToolbar,this.topologyInstance,this.infoPanel];if(null==e)for(var o=0;o<i.length;o++)this.assignBroadcastMessage(s=i[o]);else for(var s,o=0;o<i.length;o++)(s=i[o]).rxMessage&&s!=e&&s.rxMessage(t)},c.prototype.initUILayout=function(){$("body").layout({closable:!0,resizable:!0,slidable:!0,livePaneResizing:!0,north__slidable:!1,north__spacing_closed:6,north__spacing_open:0,north__resizable:!1,north__closable:!1,west__closable:!1,west__closable:!1,east__closable:!1,east__closable:!1,west__minSize:100,east__size:300,east__minSize:200,east__maxSize:.5,center__minWidth:100,east__initClosed:!0});$.layout.disableTextSelection=function(){var e=$(document),t="textSelectionDisabled",i="textSelectionInitialized";$.fn.disableSelection&&(e.data(i)||e.on("mouseup",$.layout.enableTextSelection).data(i,!0),e.data(t)||e.disableSelection().data(t,!0))},$.layout.enableTextSelection=function(){var e=$(document),t="textSelectionDisabled";$.fn.enableSelection&&e.data(t)&&e.enableSelection().data(t,!1)},$(".ui-layout-resizer-north").hide(),$(".ui-layout-west").css("border-right","solid 1px lightGray"),$(".ui-layout-west").addClass("w3-card")},t.exports=new c},{"./adtInstanceSelectionDialog":1,"./editLayoutDialog":2,"./infoPanel":3,"./mainToolbar":5,"./modelManagerDialog":8,"./topologyDOM.js":12,"./twinsTree":13}],7:[function(e,t,i){function o(){this.DTDLModels={},this.relationshipTypes={}}o.prototype.clearAllModels=function(){for(var e in console.log("clear all model info"),this.DTDLModels)delete this.DTDLModels[e]},o.prototype.addModels=function(e){e.forEach(e=>{var t=e["@id"];this.DTDLModels[t]=e})},o.prototype.recordAllBaseClasses=function(t,e){var i=this.DTDLModels[e];null!=i&&(t[e]=1,null!=(i=i.extends)&&(Array.isArray(i)?i:[i]).forEach(e=>{this.recordAllBaseClasses(t,e)}))},o.prototype.expandEditablePropertiesFromBaseClass=function(t,e){var i=this.DTDLModels[e];if(null!=i){if(i.editableProperties)for(var o in i.editableProperties)t[o]=i.editableProperties[o];e=i.extends;null!=e&&(Array.isArray(e)?e:[e]).forEach(e=>{this.expandEditablePropertiesFromBaseClass(t,e)})}},o.prototype.expandValidRelationshipTypesFromBaseClass=function(t,e){var i=this.DTDLModels[e];if(null!=i){if(i.validRelationships)for(var o in i.validRelationships)null==t[o]&&(t[o]=this.relationshipTypes[o][e]);i=i.extends;null!=i&&(Array.isArray(i)?i:[i]).forEach(e=>{this.expandValidRelationshipTypesFromBaseClass(t,e)})}},o.prototype.expandEditableProperties=function(i,e,o){e.forEach(e=>{var t;"Relationship"!=e["@type"]&&("Property"==e["@type"]||Array.isArray(e["@type"])&&e["@type"].includes("Property")||null==e["@type"])&&("object"!=typeof e.schema&&null!=o[e.schema]&&(e.schema=o[e.schema]),"object"==typeof e.schema&&"Object"==e.schema["@type"]?(i[e.name]=t={},this.expandEditableProperties(t,e.schema.fields,o)):"object"==typeof e.schema&&"Enum"==e.schema["@type"]?i[e.name]=e.schema.enumValues:i[e.name]=e.schema)})},o.prototype.analyze=function(){for(var e in console.log("analyze model info"),this.relationshipTypes)delete this.relationshipTypes[e];for(var t in this.DTDLModels){var i=this.DTDLModels[t],o={};i.schemas&&(Array.isArray(i.schemas)?i.schemas:[i.schemas]).forEach(e=>{o[e["@id"]]=e});var s=i.contents;s&&s.forEach(e=>{"Relationship"==e["@type"]&&(this.relationshipTypes[e.name]||(this.relationshipTypes[e.name]={}),(this.relationshipTypes[e.name][t]=e).editableRelationshipProperties={},Array.isArray(e.properties)&&this.expandEditableProperties(e.editableRelationshipProperties,e.properties,o))})}for(var t in this.DTDLModels){i=this.DTDLModels[t],o={};i.schemas&&(Array.isArray(i.schemas)?i.schemas:[i.schemas]).forEach(e=>{o[e["@id"]]=e}),i.editableProperties={},i.validRelationships={},i.includedComponents=[],i.allBaseClasses={},Array.isArray(i.contents)&&(this.expandEditableProperties(i.editableProperties,i.contents,o),i.contents.forEach(e=>{"Relationship"==e["@type"]&&(i.validRelationships[e.name]=this.relationshipTypes[e.name][t])}))}for(var t in this.DTDLModels){i=this.DTDLModels[t];Array.isArray(i.contents)&&i.contents.forEach(e=>{var t;"Component"==e["@type"]&&(t=e.name,e=e.schema,i.editableProperties[t]={},this.expandEditablePropertiesFromBaseClass(i.editableProperties[t],e),i.includedComponents.push(t))})}for(var t in this.DTDLModels){var a=(i=this.DTDLModels[t]).extends;null!=a&&(Array.isArray(a)?a:[a]).forEach(e=>{this.recordAllBaseClasses(i.allBaseClasses,e),this.expandEditablePropertiesFromBaseClass(i.editableProperties,e),this.expandValidRelationshipTypesFromBaseClass(i.validRelationships,e)})}},t.exports=new o},{}],8:[function(e,t,i){const r=e("./modelAnalyzer"),l=e("./adtInstanceSelectionDialog"),d=e("./simpleConfirmDialog");function o(){this.visualDefinition={},this.models={},this.DOM||(this.DOM=$('<div style="position:absolute;top:50%;background-color:white;left:50%;transform: translateX(-50%) translateY(-50%);z-index:99" class="w3-card-2"></div>'),this.DOM.css("overflow","hidden"),$("body").append(this.DOM),this.DOM.hide())}o.prototype.preparationFunc=async function(){return new Promise((i,t)=>{try{$.get("visualDefinition/readVisualDefinition",(e,t)=>{""!=e&&"object"==typeof e&&(this.visualDefinition=e),i()})}catch(e){t(e)}})},o.prototype.popup=async function(){this.DOM.show(),this.DOM.empty(),this.contentDOM=$('<div style="width:650px"></div>'),this.DOM.append(this.contentDOM),this.contentDOM.append($('<div style="height:40px" class="w3-bar w3-red"><div class="w3-bar-item" style="font-size:1.5em">Digital Twin Models</div></div>'));var e=$('<button class="w3-bar-item w3-button w3-right" style="font-size:2em;padding-top:4px">×</button>');this.contentDOM.children(":first").append(e),e.on("click",()=>{this.DOM.hide()});var t=$('<button class="w3-button w3-card w3-deep-orange w3-hover-light-green" style="height:100%">Import</button>'),i=$('<input type="file" name="modelFiles" multiple="multiple" style="display:none"></input>');this.contentDOM.children(":first").append(t,i),t.on("click",()=>{i.trigger("click")}),i.change(e=>{e=e.target.files;this.readModelFilesContentAndImport(e)});var o=$('<div class="w3-cell-row" style="margin-top:2px"></div>');this.contentDOM.append(o);e=$('<div class="w3-cell" style="width:240px;padding-right:5px"></div>');o.append(e),e.append($('<div style="height:30px" class="w3-bar w3-red"><div class="w3-bar-item" style="">Models</div></div>'));t=$('<ul class="w3-ul w3-hoverable">');t.css({"overflow-x":"hidden","overflow-y":"auto",height:"420px",border:"solid 1px lightgray"}),e.append(t),this.modelList=t;t=$('<div class="w3-container w3-cell"></div>');o.append(t);o=$('<div class="w3-card-2 w3-white" style="margin-top:2px"></div>');this.modelButtonBar=$('<div class="w3-bar" style="height:35px"></div>'),o.append(this.modelButtonBar),t.append(o);t=$('<div style="width:400px;height:405px;overflow:auto;margin-top:2px"></div>');o.append(t),this.panelCard=t,this.modelButtonBar.empty(),t.html("<a style='display:block;font-style:italic;color:gray'>Choose a model to view infomration</a>"),this.listModels()},o.prototype.resizeImgFile=async function(i,a){return new Promise((o,t)=>{try{var e=new FileReader,s=new Image;e.onload=()=>{s.onload=()=>{var e=document.createElement("canvas"),t=s.width,i=s.height;i<t?a<t&&(i*=a/t,t=a):a<i&&(t*=a/i,i=a),e.width=t,e.height=i,e.getContext("2d").drawImage(s,0,0,t,i);e=e.toDataURL("image/png");o(e)},s.src=e.result},e.readAsDataURL(i)}catch(e){t(e)}})},o.prototype.fillRightSpan=async function(e){this.panelCard.empty();var i=this.models[e]["@id"],t=$('<button style="margin-bottom:2px" class="w3-button w3-light-gray w3-hover-pink w3-border-right">Delete Model</button>'),o=$('<button class="w3-button w3-light-gray w3-hover-amber w3-border-right">Upload Avarta</button>'),s=$('<input type="file" name="img" style="display:none"></input>'),a=$('<button class="w3-button w3-light-gray w3-hover-pink w3-border-right">Clear Avarta</button>');this.modelButtonBar.append(t,o,s,a),o.on("click",()=>{s.trigger("click")}),s.change(async e=>{var t=e.target.files[0],e=await this.resizeImgFile(t,70);this.avartaImg&&this.avartaImg.attr("src",e);t=this.visualDefinition[l.selectedADT];t[i]||(t[i]={}),t[i].avarta=e,this.saveVisualDefinition(),this.broadcastMessage({message:"visualDefinitionChange",modelID:i,avarta:e})}),a.on("click",()=>{var e=this.visualDefinition[l.selectedADT];e[i]&&delete e[i].avarta,this.avartaImg&&this.avartaImg.removeAttr("src"),this.saveVisualDefinition(),this.broadcastMessage({message:"visualDefinitionChange",modelID:i,noAvarta:!0})}),t.on("click",()=>{var e=new d;e.show({width:"250px"},{title:"Warning",content:'This will DELETE model "'+i+'"',buttons:[{colorClass:"w3-red w3-hover-pink",text:"Confirm",clickFunc:()=>{e.close(),$.post("editADT/deleteModel",{model:i},e=>{""==e?(this.listModels("shouldBroadcast"),this.panelCard.empty(),this.visualDefinition[l.selectedADT]&&this.visualDefinition[l.selectedADT][i]&&(delete this.visualDefinition[l.selectedADT][i],this.saveVisualDefinition())):alert(e)})}},{colorClass:"w3-gray",text:"Cancel",clickFunc:()=>{e.close()}}]})});var n=this.addAPartInRightSpan("Visualization"),o=this.addAPartInRightSpan("Editable Properties And Relationships"),a=this.addAPartInRightSpan("Base Classes"),t=this.addAPartInRightSpan("Original Definition"),e=JSON.stringify(this.models[e],null,2);t.append($('<pre id="json">'+e+"</pre>"));e=r.DTDLModels[i].editableProperties;this.fillEditableProperties(e,o);e=r.DTDLModels[i].validRelationships;this.fillRelationshipInfo(e,o),this.fillVisualization(i,n),this.fillBaseClasses(r.DTDLModels[i].allBaseClasses,a)},o.prototype.fillBaseClasses=function(e,t){for(var i in e){i=$("<label style='display:block;padding:.1em'>"+i+"</label>");t.append(i)}},o.prototype.fillVisualization=function(e,t){var i=r.DTDLModels[e],o=$("<table style='width:100%'></table>");o.html("<tr><td></td><td></td></tr>"),t.append(o);var s=o.find("td:first"),t=o.find("td:nth-child(2)");t.css({width:"50px",height:"50px",border:"solid 1px lightGray"});o=$("<img></img>");t.append(o);var a,t=this.visualDefinition[l.selectedADT];for(a in t&&t[e]&&t[e].avarta&&o.attr("src",t[e].avarta),this.avartaImg=o,this.addOneVisualizationRow(e,s),i.validRelationships)this.addOneVisualizationRow(e,s,a)},o.prototype.addOneVisualizationRow=function(i,e,o){var t=null==o?"◯":"⟜ "+o,s=$("<div style='padding-bottom:8px'></div>");e.append(s);e=$("<label style='margin-right:10px'>"+t+"</label>");s.append(e);t=null,e=this.visualDefinition[l.selectedADT];null==o?e&&e[i]&&e[i].color&&(t=e[i].color):e&&e[i]&&e[i].relationships&&e[i].relationships[o]&&(t=e[i].relationships[o]);var a=$('<select class="w3-border" style="outline:none"></select>');s.append(a);["Black","LightGray","Red","Green","Blue","Bisque","Brown","Coral","Crimson","DodgerBlue","Gold"].forEach(e=>{var t=$("<option value='"+e+"'>"+e+"▧</option>");a.append(t),t.css("color",e)}),null!=t&&(a.val(t),a.css("color",t)),a.change(e=>{var t=e.target.value;a.css("color",t),this.visualDefinition[l.selectedADT]||(this.visualDefinition[l.selectedADT]={});e=this.visualDefinition[l.selectedADT];e[i]||(e[i]={}),o?(e[i].relationships||(e[i].relationships={}),e[i].relationships[o]=t,this.broadcastMessage({message:"visualDefinitionChange",srcModelID:i,relationshipName:o,color:t})):(e[i].color=t,this.broadcastMessage({message:"visualDefinitionChange",modelID:i,color:t})),this.saveVisualDefinition()})},o.prototype.saveVisualDefinition=function(){$.post("visualDefinition/saveVisualDefinition",{visualDefinitionJson:this.visualDefinition})},o.prototype.fillRelationshipInfo=function(e,t){for(var i in e){var o=$("<label style='display:inline;padding:.1em .3em .1em .3em;margin-right:.3em'>"+i+"</label>");t.append(o),o.css("padding-top",".1em");o=$("<label style='display:inline;background-color:yellowgreen;color:white;font-size:9px;padding:2px'>Relationship type</label>");t.append(o);o=$("<label></label>");o.css("display","block"),o.css("padding-left","1em"),t.append(o),this.fillEditableProperties(e[i].editableRelationshipProperties,o)}},o.prototype.fillEditableProperties=function(e,t){for(var i in e){var o=$("<label style='display:block'><div style='display:inline;padding:.1em .3em .1em .3em;margin-right:.3em'>"+i+"</div></label>");t.append(o),o.css("padding-top",".1em");var s=$("<label></label>");Array.isArray(e[i])?(s.text("enum"),s.css({"background-color":"darkGray",color:"white",fontSize:"9px",padding:"2px"})):"object"==typeof e[i]?(s.css("display","block"),s.css("padding-left","1em"),this.fillEditableProperties(e[i],s)):(s.text(e[i]),s.css({"background-color":"darkGray",color:"white",fontSize:"9px",padding:"2px"})),o.append(s)}},o.prototype.addAPartInRightSpan=function(e){var t=$('<button class="w3-button w3-block w3-light-grey w3-left-align" style="font-weight:bold"></button>');t.text(e);var i=$('<div class="w3-container w3-hide w3-border w3-show" style="background-color:white"></div>');return this.panelCard.append(t,i),t.on("click",e=>(i.hasClass("w3-show")?i.removeClass("w3-show"):i.addClass("w3-show"),!1)),i},o.prototype.readModelFilesContentAndImport=async function(e){for(var t,i=[],o=0;t=e[o];o++)if("application/json"==t.type)try{var s=await this.readOneFile(t),a=JSON.parse(s);i.push(a)}catch(e){alert(e)}0!=i.length&&(console.log(i),$.post("editADT/importModels",{models:i},e=>{""==e?this.listModels("shouldBroadCast"):alert(e)}))},o.prototype.readOneFile=async function(o){return new Promise((e,t)=>{try{var i=new FileReader;i.onload=()=>{e(i.result)},i.readAsText(o)}catch(e){t(e)}})},o.prototype.assignEventToOneModel=function(i){i.on("click",e=>{this.modelList.children().each((e,t)=>{$(t).removeClass("w3-amber")}),i.addClass("w3-amber");var t=i.data("modelName");t&&this.fillRightSpan(t)})},o.prototype.listModels=function(s){for(var e in this.modelList.empty(),this.models)delete this.models[e];$.get("queryADT/listModels",(e,t)=>{if((e=""==e?[]:e).forEach(e=>{null==e.displayName&&(e.displayName=e["@id"]),this.models[e.displayName]=e}),s&&(r.clearAllModels(),r.addModels(e),r.analyze()),0==e.length){e=$('<li style="font-size:0.9em">zero model record. Please import...</li>');this.modelList.append(e),e.css("cursor","default")}else{var i,o=[];for(i in this.models)o.push(i);o.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),o.forEach(e=>{var t=$('<li style="font-size:0.9em">'+e+"</li>");t.css("cursor","default"),t.data("modelName",e),this.modelList.append(t),this.assignEventToOneModel(t)})}s&&this.broadcastMessage({message:"ADTModelsChange",models:this.models})})},t.exports=new o},{"./adtInstanceSelectionDialog":1,"./modelAnalyzer":7,"./simpleConfirmDialog":9}],9:[function(e,t,i){function o(){this.DOM=$('<div style="position:absolute;top:50%;background-color:white;left:50%;transform: translateX(-50%) translateY(-50%);z-index:102" class="w3-card-4"></div>'),this.DOM.css("overflow","hidden")}o.prototype.show=function(e,t){this.DOM.css(e),this.DOM.append($('<div style="height:40px" class="w3-bar w3-red"><div class="w3-bar-item" style="font-size:1.2em">'+t.title+"</div></div>"));e=$('<button class="w3-bar-item w3-button w3-right" style="font-size:2em;padding-top:4px">×</button>');this.DOM.children(":first").append(e),e.on("click",()=>{this.close()});e=$('<div class="w3-container" style="margin-top:10px;margin-bottom:10px"></div>');e.text(t.content),this.DOM.append(e),this.bottomBar=$('<div class="w3-bar"></div>'),this.DOM.append(this.bottomBar),t.buttons.forEach(e=>{var t=$('<button class="w3-button w3-right '+(e.colorClass||"")+'" style="margin-right:2px;margin-left:2px">'+e.text+"</button>");t.on("click",()=>{e.clickFunc()}),this.bottomBar.append(t)}),$("body").append(this.DOM)},o.prototype.close=function(){this.DOM.remove()},t.exports=o},{}],10:[function(e,t,i){function o(e,t){(t=t||{}).isClickable?(this.isClickable=!0,this.DOM=$('<div class="w3-dropdown-click"></div>')):this.DOM=$('<div class="w3-dropdown-hover "></div>'),this.button=$('<button class="w3-button" style="outline: none;"><a>'+e+'</a><a style="font-weight:bold;padding-left:2px"></a><i class="fa fa-caret-down" style="padding-left:3px"></i></button>'),t.withBorder&&this.button.addClass("w3-border"),t.fontSize&&this.DOM.css("font-size",t.fontSize),t.colorClass&&this.button.addClass(t.colorClass),t.width&&this.button.css("width",t.width),t.buttonCSS&&this.button.css(t.buttonCSS),this.optionContentDOM=$('<div class="w3-dropdown-content w3-bar-block w3-card-4">'),this.DOM.append(this.button,this.optionContentDOM),this.curSelectVal=null,t.isClickable&&this.button.on("click",e=>{this.optionContentDOM.hasClass("w3-show")?this.optionContentDOM.removeClass("w3-show"):this.optionContentDOM.addClass("w3-show")})}o.prototype.findOption=function(e){for(var t=this.optionContentDOM.children(),i=0;i<t.length;i++){var o=$(t[i]);if(e==o.data("optionValue"))return{text:o.text(),value:o.data("optionValue")}}},o.prototype.addOption=function(t,e){var i=$('<a href="#" class="w3-bar-item w3-button">'+t+"</a>");this.optionContentDOM.append(i),i.data("optionValue",e||t),i.on("click",e=>{this.curSelectVal=i.data("optionValue"),this.isClickable?this.optionContentDOM.removeClass("w3-show"):(this.DOM.removeClass("w3-dropdown-hover"),this.DOM.addClass("w3-dropdown-click"),setTimeout(()=>{this.DOM.addClass("w3-dropdown-hover"),this.DOM.removeClass("w3-dropdown-click")},100)),this.callBack_clickOption(t,i.data("optionValue"))})},o.prototype.changeName=function(e,t){this.button.children(":first").text(e),this.button.children().eq(1).text(t)},o.prototype.triggerOptionIndex=function(e){e=this.optionContentDOM.children().eq(e);if(0==e.length)return this.curSelectVal=null,void this.callBack_clickOption(null,null);this.curSelectVal=e.data("optionValue"),this.callBack_clickOption(e.text(),e.data("optionValue"))},o.prototype.triggerOptionValue=function(e){e=this.findOption(e);null==e?(this.curSelectVal=null,this.callBack_clickOption(null,null)):(this.curSelectVal=e.value,this.callBack_clickOption(e.text,e.value))},o.prototype.clearOptions=function(e,t){this.optionContentDOM.empty(),this.curSelectVal=null},o.prototype.callBack_clickOption=function(e,t){},t.exports=o},{}],11:[function(e,t,i){"use strict";function o(e){this.DOM=e,this.groupNodes=[],this.selectedNodes=[]}function s(e,t){this.parentTree=e,this.info=t,this.childLeafNodes=[],this.name=t.displayName,this.createDOM()}function a(e,t){this.parentGroupNode=e,this.leafInfo=t,this.name=this.leafInfo.$dtId,this.createLeafNodeDOM()}o.prototype.scrollToLeafNode=function(e){var t=this.DOM.scrollTop(),i=this.DOM.height(),e=e.DOM.position().top;i-50<e?this.DOM.scrollTop(t+e-(i-50)):e<50&&this.DOM.scrollTop(t+(e-50))},o.prototype.clearAllLeafNodes=function(){this.groupNodes.forEach(e=>{e.listDOM.empty(),e.childLeafNodes.length=0,e.refreshName()})},o.prototype.firstLeafNode=function(){if(0==this.groupNodes.length)return null;var t=null;return this.groupNodes.forEach(e=>{null==t&&0<e.childLeafNodes.length&&(t=e.childLeafNodes[0])}),t},o.prototype.nextGroupNode=function(e){if(null!=e){e=this.groupNodes.indexOf(e);return this.groupNodes.length-1>e?this.groupNodes[e+1]:this.groupNodes[0]}},o.prototype.nextLeafNode=function(e){if(null!=e){var t=e.parentGroupNode,e=t.childLeafNodes.indexOf(e);if(t.childLeafNodes.length-1>e)return t.childLeafNodes[e+1];for(;;){var i=this.nextGroupNode(t);if(0!=i.childLeafNodes.length)return i.childLeafNodes[0];t=i}}},o.prototype.searchText=function(e){if(""==e)return null;var t,i=new RegExp(e,"i");if(0==this.selectedNodes.length){if(null==(t=this.firstLeafNode()))return;if(null!=t.name.match(i))return t}else t=this.selectedNodes[0];if(null==t)return null;for(var o=t;;){var s=this.nextLeafNode(o);if(s==t)return null;if(null!=s.name.match(i))return s;o=s}},o.prototype.addLeafnodeToGroup=function(e,t,i){e=this.findGroupNode(e);null!=e&&e.addNode(t,i)},o.prototype.removeAllNodes=function(){this.groupNodes.length=0,this.selectedNodes.length=0,this.DOM.empty()},o.prototype.findGroupNode=function(t){var i=null;return this.groupNodes.forEach(e=>{e.name==t&&(i=e)}),i},o.prototype.delGroupNode=function(e){e.deleteSelf()},o.prototype.deleteLeafNode=function(t){var i=null;this.groupNodes.forEach(e=>{null==i&&e.childLeafNodes.forEach(e=>{e.name==t&&(i=e)})}),null!=i&&i.deleteSelf()},o.prototype.insertGroupNode=function(e,t){var i=new s(this,e),e=this.findGroupNode(i.name);if(null==e)return this.groupNodes.splice(t,0,i),0==t?(this.DOM.append(i.headerDOM),this.DOM.append(i.listDOM)):(t=this.groupNodes[t-1],i.headerDOM.insertAfter(t.listDOM),i.listDOM.insertAfter(i.headerDOM)),i},o.prototype.addGroupNode=function(e){e=new s(this,e);if(null==this.findGroupNode(e.name))return this.groupNodes.push(e),this.DOM.append(e.headerDOM),this.DOM.append(e.listDOM),e},o.prototype.selectLeafNode=function(e,t){this.selectLeafNodeArr([e],t)},o.prototype.appendLeafNodeToSelection=function(e){var t=[].concat(this.selectedNodes);t.push(e),this.selectLeafNodeArr(t)},o.prototype.selectGroupNode=function(e){this.callback_afterSelectGroupNode&&this.callback_afterSelectGroupNode(e.info)},o.prototype.selectLeafNodeArr=function(e,t){for(var i=0;i<this.selectedNodes.length;i++)this.selectedNodes[i].dim();this.selectedNodes.length=0,this.selectedNodes=this.selectedNodes.concat(e);for(i=0;i<this.selectedNodes.length;i++)this.selectedNodes[i].highlight();this.callback_afterSelectNodes&&this.callback_afterSelectNodes(this.selectedNodes,t)},o.prototype.dblClickNode=function(e){this.callback_afterDblclickNode&&this.callback_afterDblclickNode(e)},s.prototype.refreshName=function(){this.headerDOM.text(this.name+"("+this.childLeafNodes.length+")"),0<this.childLeafNodes.length?this.headerDOM.css("font-weight","bold"):this.headerDOM.css("font-weight","normal")},s.prototype.deleteSelf=function(){this.headerDOM.remove(),this.listDOM.remove();var e=this.parentTree.groupNodes,t=e.indexOf(this);-1<t&&e.splice(t,1)},s.prototype.createDOM=function(){this.headerDOM=$('<button class="w3-button w3-block w3-light-grey w3-left-align"></button>'),this.refreshName(),this.listDOM=$('<div class="w3-container w3-hide w3-border"></div>'),this.headerDOM.on("click",e=>(this.listDOM.hasClass("w3-show")?this.listDOM.removeClass("w3-show"):this.listDOM.addClass("w3-show"),this.parentTree.selectGroupNode(this),!1))},s.prototype.isOpen=function(){return this.listDOM.hasClass("w3-show")},s.prototype.expand=function(){this.listDOM.addClass("w3-show")},s.prototype.shrink=function(){this.listDOM.removeClass("w3-show")},s.prototype.addNode=function(t,e){if(e){var i=!1;if(this.childLeafNodes.forEach(e=>{e.name==t.$dtId&&(i=!0)}),i)return}e=new a(this,t);this.childLeafNodes.push(e),this.refreshName(),this.listDOM.append(e.DOM)},a.prototype.deleteSelf=function(){this.DOM.remove();var e=this.parentGroupNode,t=e.childLeafNodes.indexOf(this);-1<t&&e.childLeafNodes.splice(t,1),e.refreshName()},a.prototype.createLeafNodeDOM=function(){this.DOM=$('<button class="w3-button w3-white" style="display:block;text-align:left;width:98%">'+this.name+"</button>");var t=e=>{this.highlight();e.detail;e.ctrlKey?this.parentGroupNode.parentTree.appendLeafNodeToSelection(this):this.parentGroupNode.parentTree.selectLeafNode(this,e.detail)};this.DOM.on("click",e=>{t(e)}),this.DOM.on("dblclick",e=>{this.parentGroupNode.parentTree.dblClickNode(this)})},a.prototype.highlight=function(){this.DOM.addClass("w3-orange"),this.DOM.addClass("w3-hover-amber"),this.DOM.removeClass("w3-white")},a.prototype.dim=function(){this.DOM.removeClass("w3-orange"),this.DOM.removeClass("w3-hover-amber"),this.DOM.addClass("w3-white")},t.exports=o},{}],12:[function(e,t,i){"use strict";const o=e("./modelManagerDialog"),a=e("./adtInstanceSelectionDialog"),r=e("./modelAnalyzer"),l=e("./editLayoutDialog"),s=new Intl.NumberFormat("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}),d=e("./simpleSelectMenu");function n(e){this.DOM=e,this.defaultNodeSize=30}n.prototype.init=function(){cytoscape.warnings(!1),this.core=cytoscape({container:this.DOM[0],zoom:1,pan:{x:0,y:0},minZoom:.1,maxZoom:10,zoomingEnabled:!0,userZoomingEnabled:!0,panningEnabled:!0,userPanningEnabled:!0,boxSelectionEnabled:!0,selectionType:"single",touchTapThreshold:8,desktopTapThreshold:4,autolock:!1,autoungrabify:!1,autounselectify:!1,headless:!1,styleEnabled:!0,hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.2,wheelSensitivity:.3,pixelRatio:"auto",elements:[],style:[{selector:"node",style:{width:this.defaultNodeSize,height:this.defaultNodeSize,label:"data(id)",opacity:.9,"font-size":"12px","font-family":"Geneva, Arial, Helvetica, sans-serif","background-fit":"contain"}},{selector:"edge",style:{width:2,"line-color":"#888","target-arrow-color":"#555","target-arrow-shape":"triangle","curve-style":"bezier","arrow-scale":.6}},{selector:"edge:selected",style:{width:3,"line-color":"red","target-arrow-color":"red","source-arrow-color":"red"}},{selector:"node:selected",style:{"border-color":"red","border-width":2,"background-color":"Gray"}}]}),this.core.edgeEditing({undoable:!0,bendRemovalSensitivity:16,enableMultipleAnchorRemovalOption:!0,stickyAnchorTolerence:20,anchorShapeSizeFactor:5,enableAnchorSizeNotImpactByZoom:!0,enableRemoveAnchorMidOfNearLine:!1,enableCreateAnchorOnDrag:!1}),this.core.boxSelectionEnabled(!0),this.core.on("tapselect",()=>{this.selectFunction()}),this.core.on("tapunselect",()=>{this.selectFunction()}),this.core.on("boxend",e=>{this.core.one("boxselect",()=>{this.selectFunction()})}),this.core.on("cxttap",e=>{this.cancelTargetNodeMode()}),this.core.on("zoom",e=>{var t=this.getFontSizeInCurrentZoom(),i=this.getNodeSizeInCurrentZoom();this.core.style().selector("node").style({"font-size":t,width:i,height:i}).update()});var i=this.core.edgeEditing("get"),o=e=>{i.keepAnchorsAbsolutePositionDuringMoving(),e.target.isNode&&e.target.isNode()&&(this.draggingNode=e.target),this.smartPositionNode(e.position)},t=()=>{this.core.once("grab",e=>{var t=this.core.collection();e.target.isNode()&&t.merge(e.target),this.core.$(":selected").forEach(e=>{e.isNode()&&t.merge(e)}),i.storeAnchorsAbsolutePosition(t),this.core.on("tapdrag",o),s()})},s=()=>{this.core.once("free",e=>{this.core.edgeEditing("get").resetAnchorsAbsolutePosition(),this.draggingNode=null,t(),this.core.removeListener("tapdrag",o)})};t()},n.prototype.smartPositionNode=function(t){var e,i,o,s,a,n,r,l,d=this.core.zoom();this.draggingNode&&(i=(e=this.draggingNode.incomers()).outgoers(),l=(r=this.draggingNode.outgoers()).incomers(),r=e.union(i).union(r).union(l).filter("node").unmerge(this.draggingNode),l=(e,t)=>{var i=Math.min(...e);return i*d<10?t[e.indexOf(i)]:null},o=[],s=[],a=[],n=[],r.forEach(e=>{o.push(Math.abs(e.position().x-t.x)),s.push(e.position().x),a.push(Math.abs(e.position().y-t.y)),n.push(e.position().y)}),r=l(o,s),l=l(a,n),null!=r&&this.draggingNode.position("x",r),null!=l&&this.draggingNode.position("y",l))},n.prototype.selectFunction=function(){var t,e=this.core.$(":selected");0!=e.length&&(t=[],e.forEach(e=>{t.push(e.data().originalInfo)}),this.broadcastMessage({message:"selectNodes",info:t}))},n.prototype.getFontSizeInCurrentZoom=function(){var e,t,i,o=this.core.zoom();return 1<o?(i=((e=12)/(t=5)-1)/9*(o-1)+1,Math.ceil(e/i)):(i=((e=120)/(t=12)-1)/9*(1/o-1)+1,Math.ceil(t*i))},n.prototype.getNodeSizeInCurrentZoom=function(){var e=this.core.zoom();if(1<e){var t=(e-1)/9+1;return Math.ceil(this.defaultNodeSize/t)}t=3*(1/e-1)/9+1;return Math.ceil(this.defaultNodeSize*t)},n.prototype.updateModelAvarta=function(e,t){try{this.core.style().selector('node[modelID = "'+e+'"]').style({"background-image":t}).update()}catch(e){}},n.prototype.updateModelTwinColor=function(e,t){this.core.style().selector('node[modelID = "'+e+'"]').style({"background-color":t}).update()},n.prototype.updateRelationshipColor=function(e,t,i){this.core.style().selector('edge[sourceModel = "'+e+'"][relationshipName = "'+t+'"]').style({"line-color":i}).update()},n.prototype.deleteRelations=function(e){e.forEach(e=>{for(var t=e.srcID,i=e.relID,o=this.core.filter('[id = "'+t+'"]').connectedEdges().toArray(),s=0;s<o.length;s++){var a=o[s];if(a.data("originalInfo").$relationshipId==i){a.remove();break}}})},n.prototype.deleteTwins=function(e){e.forEach(e=>{this.core.$('[id = "'+e+'"]').remove()})},n.prototype.animateANode=function(e){var t=this.getNodeSizeInCurrentZoom();e.animate({style:{height:2*t,width:2*t},duration:200}),setTimeout(()=>{e.animate({style:{height:t,width:t},duration:200,complete:()=>{e.removeStyle()}})},200)},n.prototype.drawTwins=function(e,t){for(var i=[],o=0;o<e.length;o++){var s=e[o],a={data:{},group:"nodes"};a.data.originalInfo=s,a.data.id=s.$dtId;s=s.$metadata.$model;a.data.modelID=s,i.push(a)}var n=this.core.add(i);return 0==n.size()||(this.noPosition_grid(n),t&&n.forEach(e=>{this.animateANode(e)}),this.applyNewLayout()),n},n.prototype.drawRelations=function(e){for(var t=[],i=0;i<e.length;i++){var o,s=e[i],a=s.$relationshipName+"_"+s.$relationshipId,n={data:{},group:"edges"};n.data.originalInfo=s,n.data.id=a,n.data.source=s.$sourceId,n.data.target=s.$targetId,0!=this.core.$("#"+n.data.source).length&&0!=this.core.$("#"+n.data.target).length&&(o=this.core.$("#"+n.data.source)[0].data("originalInfo").$metadata.$model,s.sourceModel=o,n.data.sourceModel=o,n.data.relationshipName=s.$relationshipName,0<(a=this.core.$('edge[id = "'+a+'"]')).size()?a.data("originalInfo",s):t.push(n))}return 0==t.length?null:this.core.add(t)},n.prototype.reviewStoredRelationshipsToDraw=function(){var e,t=[];for(e in a.storedOutboundRelationships)t=t.concat(a.storedOutboundRelationships[e]);this.drawRelations(t)},n.prototype.drawTwinsAndRelations=function(e){var e=e.childTwinsAndRelations,s=this.core.collection();e.forEach(e=>{var t,i=[];for(t in e.childTwins)i.push(e.childTwins[t]);var o=this.drawTwins(i,"animation");s=s.union(o)});var i={};e.forEach(e=>{e.relationships.forEach(e=>{var t=e.$sourceId,e=e.$targetId;a.storedTwins[t]&&(i[t]=a.storedTwins[t]),a.storedTwins[e]&&(i[e]=a.storedTwins[e])})});var t,o=[];for(t in i)o.push(i[t]);this.drawTwins(o),this.reviewStoredRelationshipsToDraw()},n.prototype.applyVisualDefinition=function(){var e=o.visualDefinition[a.selectedADT];if(null!=e)for(var t in e)if(e[t].color&&this.updateModelTwinColor(t,e[t].color),e[t].avarta&&this.updateModelAvarta(t,e[t].avarta),e[t].relationships)for(var i in e[t].relationships)this.updateRelationshipColor(t,i,e[t].relationships[i])},n.prototype.rxMessage=function(e){var t,i,o;"ADTDatasourceChange_replace"==e.message?(this.core.nodes().remove(),this.applyVisualDefinition()):"replaceAllTwins"==e.message?(this.core.nodes().remove(),t=this.drawTwins(e.info),this.core.center(t)):"appendAllTwins"==e.message?(t=this.drawTwins(e.info,"animate"),this.core.center(t),this.reviewStoredRelationshipsToDraw()):"drawAllRelations"==e.message?null!=this.drawRelations(e.info)&&null==l.currentLayoutName&&this.noPosition_cose():"addNewTwin"==e.message?this.drawTwins([e.twinInfo],"animation"):"drawTwinsAndRelations"==e.message?this.drawTwinsAndRelations(e.info):"selectNodes"==e.message?(this.core.nodes().unselect(),this.core.edges().unselect(),o=e.info,i=e.mouseClickDetail,o.forEach(e=>{e=this.core.nodes("#"+e.$dtId);e.select(),2!=i&&this.animateANode(e)})):"PanToNode"==e.message?(o=e.info,(o=this.core.nodes("#"+o.$dtId))&&this.core.center(o)):"visualDefinitionChange"==e.message?e.srcModelID?this.updateRelationshipColor(e.srcModelID,e.relationshipName,e.color):e.color?this.updateModelTwinColor(e.modelID,e.color):e.avarta?this.updateModelAvarta(e.modelID,e.avarta):e.noAvarta&&this.updateModelAvarta(e.modelID,null):"twinsDeleted"==e.message?this.deleteTwins(e.twinIDArr):"relationsDeleted"==e.message?this.deleteRelations(e.relations):"connectTo"==e.message?this.startTargetNodeMode("connectTo"):"connectFrom"==e.message?this.startTargetNodeMode("connectFrom"):"addSelectOutbound"==e.message?this.selectOutboundNodes():"addSelectInbound"==e.message?this.selectInboundNodes():"hideSelectedNodes"==e.message?this.hideSelectedNodes():"COSESelectedNodes"==e.message?this.COSESelectedNodes():"saveLayout"==e.message?this.saveLayout(e.layoutName,e.adtName):"layoutChange"==e.message&&this.applyNewLayout()},n.prototype.applyNewLayout=function(){var e=l.currentLayoutName,t=l.layoutJSON[e];if(this.core.edges().forEach(e=>{e.removeClass("edgebendediting-hasbendpoints"),e.removeClass("edgecontrolediting-hascontrolpoints")}),null!=t){var i,o={};for(i in t)o[i]={x:t[i][0],y:t[i][1]};this.core.layout({name:"preset",positions:o,fit:!1,animate:!0,animationDuration:300}).run();var s=t.edges;if(null!=s)for(var a in s)for(var n in s[a]){var r=s[a][n];this.applyEdgeBendcontrolPoints(a,n,r.cyedgebendeditingWeights,r.cyedgebendeditingDistances,r.cyedgecontroleditingWeights,r.cyedgecontroleditingDistances)}}},n.prototype.applyEdgeBendcontrolPoints=function(e,t,i,o,s,a){for(var n=this.core.filter('[id = "'+e+'"]').connectedEdges().toArray(),r=0;r<n.length;r++){var l=n[r];if(l.data("originalInfo").$relationshipId==t){i&&(l.data("cyedgebendeditingWeights",i),l.data("cyedgebendeditingDistances",o),l.addClass("edgebendediting-hasbendpoints")),s&&(l.data("cyedgecontroleditingWeights",s),l.data("cyedgecontroleditingDistances",a),l.addClass("edgecontrolediting-hascontrolpoints"));break}}},n.prototype.saveLayout=function(e,t){var n=(n=l.layoutJSON[e])||(l.layoutJSON[e]={});0!=this.core.nodes().size()&&(this.core.nodes().forEach(e=>{var t=e.position();n[e.id()]=[this.numberPrecision(t.x),this.numberPrecision(t.y)]}),null==n.edges&&(n.edges={}),this.core.edgeEditing("get"),this.core.edges().forEach(e=>{var t=e.data("originalInfo").$sourceId,i=e.data("originalInfo").$relationshipId,o=e.data("cyedgebendeditingWeights"),s=e.data("cyedgebendeditingDistances"),a=e.data("cyedgecontroleditingWeights"),e=e.data("cyedgecontroleditingDistances");(o||a)&&(null==n.edges[t]&&(n.edges[t]={}),n.edges[t][i]={},o&&0<o.length&&(n.edges[t][i].cyedgebendeditingWeights=this.numberPrecision(o),n.edges[t][i].cyedgebendeditingDistances=this.numberPrecision(s)),a&&0<a.length&&(n.edges[t][i].cyedgecontroleditingWeights=this.numberPrecision(a),n.edges[t][i].cyedgecontroleditingDistances=this.numberPrecision(e)))}),$.post("layout/saveLayouts",{adtName:t,layouts:JSON.stringify(l.layoutJSON)}),this.broadcastMessage({message:"layoutsUpdated"}))},n.prototype.numberPrecision=function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)e[t]=this.numberPrecision(e[t]);return e}return parseFloat(s.format(e))},n.prototype.COSESelectedNodes=function(){var e=this.core.$(":selected");this.noPosition_cose(e)},n.prototype.hideSelectedNodes=function(){this.core.nodes(":selected").remove()},n.prototype.selectInboundNodes=function(){var e=this.core.nodes(":selected"),e=this.core.nodes().edgesTo(e).sources();e.forEach(e=>{this.animateANode(e)}),e.select(),this.selectFunction()},n.prototype.selectOutboundNodes=function(){var e=this.core.nodes(":selected").edgesTo(this.core.nodes()).targets();e.forEach(e=>{this.animateANode(e)}),e.select(),this.selectFunction()},n.prototype.addConnections=function(i){var o=this.targetNodeMode,e=this.core.nodes(":selected"),s=[];e.forEach(e=>{var t;"connectTo"==o?(t=this.checkAvailableConnectionType(e.data("modelID"),i.data("modelID")),s.push({from:e,to:i,connect:t})):"connectFrom"==o&&(t=this.checkAvailableConnectionType(i.data("modelID"),e.data("modelID")),s.push({to:e,from:i,connect:t}))}),this.showConnectionDialog(s)},n.prototype.showConnectionDialog=function(e){var n=$('<div title="Add connections"></div>'),r=[];e.forEach((e,i)=>{var o,t=e.from,s=e.to,a=e.connect,e=$('<label style="display:block;margin-bottom:2px"></label>');0==a.length?(e.css("color","red"),e.html("No usable connection type from <b>"+t.id()+"</b> to <b>"+s.id()+"</b>")):1<a.length?(e.html("From <b>"+t.id()+"</b> to <b>"+s.id()+"</b>"),o=new d(" "),e.prepend(o.DOM),a.forEach(e=>{o.addOption(e)}),r.push({from:t.id(),to:s.id(),connect:a[0]}),o.callBack_clickOption=(e,t)=>{r[i][2]=e,o.changeName(e)},o.triggerOptionIndex(0)):1==a.length&&(r.push({from:t.id(),to:s.id(),connect:a[0]}),e.css("color","green"),e.html("Add <b>"+a[0]+"</b> connection from <b>"+t.id()+"</b> to <b>"+s.id()+"</b>")),n.append(e)}),$("body").append(n),n.dialog({width:450,height:300,resizable:!1,buttons:[{text:"Confirm",click:()=>{this.createConnections(r),n.dialog("destroy")}},{text:"Cancel",click:()=>{n.dialog("destroy")}}]})},n.prototype.createConnections=function(e){e.forEach(i=>{var o=0,e=a.storedOutboundRelationships[i.from];(e=null==e?[]:e).forEach(e=>{var t=e.$relationshipId;e.$targetId==i.to&&(t=t.split(";").pop(),t=parseInt(t),o<=t&&(o=t+1))}),i.IDindex=o}),$.post("editADT/createRelations",{actions:e},(e,t)=>{""!=e&&(a.storeTwinRelationships_append(e),this.drawRelations(e))})},n.prototype.checkAvailableConnectionType=function(e,t){var i=[],o=r.DTDLModels[e].validRelationships,s=r.DTDLModels[t].allBaseClasses;if(o)for(var a in o){var n=o[a];null!=n.target&&n.target!=t&&null==s[n.target]||i.push(a)}return i},n.prototype.startTargetNodeMode=function(e){this.core.autounselectify(!0),this.core.container().style.cursor="crosshair",this.targetNodeMode=e,$(document).keydown(e=>{27==e.keyCode&&this.cancelTargetNodeMode()}),this.core.nodes().on("click",e=>{e=e.target;this.addConnections(e),setTimeout(()=>{this.cancelTargetNodeMode()},50)})},n.prototype.cancelTargetNodeMode=function(){this.targetNodeMode=null,this.core.container().style.cursor="default",$(document).off("keydown"),this.core.nodes().off("click"),this.core.autounselectify(!1)},n.prototype.noPosition_grid=function(e){e.layout({name:"grid",animate:!1,fit:!1}).run()},n.prototype.noPosition_cose=function(e){(e=null==e?this.core.elements():e).layout({name:"cose",animate:!0,animate:!1,gravity:1,fit:!1}).run(),this.core.center(e)},n.prototype.noPosition_concentric=function(e,t){(e=null==e?this.core.elements():e).layout({name:"concentric",animate:!1,fit:!1,minNodeSpacing:60,gravity:1,boundingBox:t}).run()},n.prototype.layoutWithNodePosition=function(e){this.core.layout({name:"preset",positions:e,animate:!1,animationDuration:500}).run()},t.exports=n},{"./adtInstanceSelectionDialog":1,"./editLayoutDialog":2,"./modelAnalyzer":7,"./modelManagerDialog":8,"./simpleSelectMenu":10}],13:[function(e,t,i){const o=e("./simpleTree"),l=e("./modelAnalyzer"),d=e("./adtInstanceSelectionDialog");function s(e,t){this.tree=new o(e),this.modelIDMapToName={},this.tree.callback_afterSelectNodes=(e,t)=>{var i=[];e.forEach((e,t)=>{i.push(e.leafInfo)}),this.broadcastMessage({message:"selectNodes",info:i,mouseClickDetail:t})},this.tree.callback_afterDblclickNode=e=>{this.broadcastMessage({message:"PanToNode",info:e.leafInfo})},this.tree.callback_afterSelectGroupNode=e=>{this.broadcastMessage({message:"selectGroupNode",info:e})},this.searchBox=$('<input type="text"  placeholder="search..."/>').addClass("w3-input"),this.searchBox.css({outline:"none",height:"100%",width:"100%"}),t.append(this.searchBox),this.searchBox.keyup(e=>{13!=e.keyCode||null!=(e=this.tree.searchText($(e.target).val()))&&(e.parentGroupNode.expand(),this.tree.selectLeafNode(e),this.tree.scrollToLeafNode(e))})}s.prototype.rxMessage=function(e){"ADTDatasourceChange_replace"==e.message?this.ADTDatasourceChange_replace(e.query,e.twins,e.ADTInstanceDoesNotChange):"ADTDatasourceChange_append"==e.message?this.ADTDatasourceChange_append(e.query,e.twins):"drawTwinsAndRelations"==e.message?this.drawTwinsAndRelations(e.info):"ADTModelsChange"==e.message?this.refreshModels(e.models):"addNewTwin"==e.message?this.drawOneTwin(e.twinInfo):"twinsDeleted"==e.message&&this.deleteTwins(e.twinIDArr)},s.prototype.deleteTwins=function(e){e.forEach(e=>{this.tree.deleteLeafNode(e)})},s.prototype.refreshModels=function(t){this.tree.groupNodes.forEach(e=>{null==t[e.name]&&e.deleteSelf()});var i=[];this.tree.groupNodes.forEach(e=>{i.push(e.name)});var e,o=[];for(e in t)o.push(e);o.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())});for(var s=0;s<o.length;s++)s<i.length&&i[s]==o[s]||(this.tree.insertGroupNode(t[o[s]],s).shrink(),i.splice(s,0,o[s]))},s.prototype.ADTDatasourceChange_append=function(e,t){null!=t?this.appendAllTwins(t):$.post("queryADT/allTwinsInfo",{query:e},e=>{""!=e&&(e.forEach(e=>{d.storedTwins[e.$dtId]=e}),this.appendAllTwins(e))})},s.prototype.ADTDatasourceChange_replace=function(a,n,e){var r=this.tree;if(e)this.tree.clearAllLeafNodes(),null!=n?this.replaceAllTwins(n):$.post("queryADT/allTwinsInfo",{query:a},e=>{(e=""==e?[]:e).forEach(e=>{d.storedTwins[e.$dtId]=e}),this.replaceAllTwins(e)});else{for(var t in r.removeAllNodes(),this.modelIDMapToName)delete this.modelIDMapToName[t];$.get("queryADT/listModels",(e,t)=>{""==e&&(e=[]);for(var i=[],o={},s=0;s<e.length;s++)null==e[s].displayName&&(e[s].displayName=e[s]["@id"]),this.modelIDMapToName[e[s]["@id"]]=e[s].displayName,i.push(e[s].displayName),o[e[s].displayName]=e[s];i.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),i.forEach(e=>{r.addGroupNode(o[e]).shrink()}),l.clearAllModels(),l.addModels(e),l.analyze(),null!=n?this.replaceAllTwins(n):$.post("queryADT/allTwinsInfo",{query:a},e=>{(e=""==e?[]:e).forEach(e=>{d.storedTwins[e.$dtId]=e}),this.replaceAllTwins(e)})})}},s.prototype.drawTwinsAndRelations=function(e){e.childTwinsAndRelations.forEach(e=>{for(var t in e.childTwins){t=e.childTwins[t];this.drawOneTwin(t)}})},s.prototype.drawOneTwin=function(e){var t=this.modelIDMapToName[e.$metadata.$model];this.tree.addLeafnodeToGroup(t,e,"skipRepeat")},s.prototype.appendAllTwins=function(e){var t=[];this.tree.groupNodes.forEach(e=>{e.childLeafNodes.forEach(e=>{e=e.leafInfo.$dtId;null==d.storedOutboundRelationships[e]&&t.push(e)})}),this.broadcastMessage({message:"appendAllTwins",info:e});for(var i=0;i<e.length;i++){var o=this.modelIDMapToName[e[i].$metadata.$model];this.tree.addLeafnodeToGroup(o,e[i],"skipRepeat"),t.push(e[i].$dtId)}this.fetchAllRelationships(t)},s.prototype.replaceAllTwins=function(e){var t=[];this.broadcastMessage({message:"replaceAllTwins",info:e});for(var i=0;i<e.length;i++){var o=this.modelIDMapToName[e[i].$metadata.$model];this.tree.addLeafnodeToGroup(o,e[i]),t.push(e[i].$dtId)}this.fetchAllRelationships(t)},s.prototype.fetchAllRelationships=async function(e){for(;0<e.length;){var t=e.splice(0,100),t=await this.fetchPartialRelationships(t);""!=t&&(d.storeTwinRelationships(t),this.broadcastMessage({message:"drawAllRelations",info:t}))}},s.prototype.fetchPartialRelationships=async function(e){return new Promise((t,i)=>{try{$.post("queryADT/allRelationships",{arr:e},function(e){t(e)})}catch(e){i(e)}})},t.exports=s},{"./adtInstanceSelectionDialog":1,"./modelAnalyzer":7,"./simpleTree":11}]},{},[4]);